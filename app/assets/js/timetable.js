let rooms;window.onload=async function(){let e=await fetch("home/json",{method:"POST",headers:{"Content-type":"application/json"}});e.ok||console.log("JSON error");let t=await e.json();rooms=t.rooms},$(document).ready(function(){$(".timetable-sm td").on("mouseover",function(){$(this).closest("tr").find("th").addClass("highlight"),$(this).closest("table").find("tr:nth-child(2) th:nth-child("+($(this).index()+1)+")").addClass("highlight")}),$(".timetable-sm td").on("mouseout",function(){$(this).closest("tr").find("th").removeClass("highlight"),$(this).closest("table").find("tr:nth-child(2) th:nth-child("+($(this).index()+1)+")").removeClass("highlight")})});let item,timetableContainer=document.getElementById("timetable-container");timetableContainer.ondragstart=(e=>{(item=e.target).style.opacity="0.5"}),timetableContainer.ondragover=(e=>{let t=e.target.closest("td");t&&(e.preventDefault(),t.style.boxShadow="0 0 15px green")}),timetableContainer.ondrop=async function(e){let t=e.target.closest("td");if(t){e.preventDefault(),(await fetch("home/setTime",{method:"POST",body:"id="+item.id+"&day="+t.id.charAt(0)+"&time="+t.id.charAt(2),headers:{"Content-type":"application/x-www-form-urlencoded"}})).ok||console.log("On drop error"),location.reload()}},timetableContainer.ondragleave=(e=>{let t=e.target.closest("td");t&&(t.style.boxShadow="none")}),timetableContainer.ondragend=(e=>{item.style.opacity="1"}),room_elements=document.getElementsByClassName("room");for(let e of room_elements)e.onclick=function(){if("SELECT"!==e.firstChild.tagName){let t=document.createElement("select");t.setAttribute("class","room-select");let o=document.createElement("option");o.setAttribute("value","NULL"),t.appendChild(o),rooms.forEach(n=>{(o=document.createElement("option")).setAttribute("value",n.id),n.name===e.innerHTML&&o.setAttribute("selected",""),o.innerHTML=n.name,t.appendChild(o)}),e.innerHTML="",e.appendChild(t),t.onchange=async function(o){if((await fetch("home/setRoom",{method:"POST",body:"id="+e.parentElement.id+"&room_id="+o.target.value,headers:{"Content-type":"application/x-www-form-urlencoded"}})).ok){let o=t.options[t.selectedIndex].text;""===o?(e.classList.remove("fix"),e.innerHTML="Missing classroom"):(e.classList.add("fix"),e.innerHTML=o)}else console.log("Room on change error")}}};