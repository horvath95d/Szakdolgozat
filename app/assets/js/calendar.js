const today=new Date;let currentMonth=today.getMonth(),currentYear=today.getFullYear();const months=["Január","Február","Március","Április","Május","Június","Július","Augusztus","Szeptember","Október","November","December"];let events;function renderCalendar(e,t){let a,r,n,d,c;document.getElementById("month").innerHTML=e+" "+months[t];let o=new Date(e,t).getDay();o=0===o?7:o;const l=32-new Date(e,t,32).getDate(),s=document.getElementById("calendar-body");s.innerHTML="";let u=1,i=1,m=0;for(let g=0;g<6;g++){const h=document.createElement("tr");for(let s=1;s<8;s++)if(0===g&&s<o)c=0===t?e-1:e,d=0===t?"12":String(t).padStart(2,"0"),n=new Date(c,d,0).getDate()-o+s+1,(r=document.createElement("td")).setAttribute("data-date",c+"-"+d+"-"+n),r.setAttribute("class","other-month"),r.setAttribute("onclick","previous()"),h.appendChild(r),(a=document.createElement("div")).setAttribute("class","date"),a.innerHTML=n,r.appendChild(a),createEvent(r,c+"."+d+"."+n),m++;else if(u>l){if((m+u-1)%7==0)break;c=11===t?e+1:e,d=11===t?"01":String(t+2).padStart(2,"0"),(r=document.createElement("td")).setAttribute("data-date",c+"-"+d+"-0"+i),r.setAttribute("class","other-month"),r.setAttribute("onclick","next()"),h.appendChild(r),(a=document.createElement("div")).setAttribute("class","date"),a.innerHTML=i,r.appendChild(a),createEvent(r,c+"."+d+".0"+i),m++,i++}else d=String(t+1).padStart(2,"0"),n=String(u).padStart(2,"0"),(r=document.createElement("td")).setAttribute("data-date",e+"-"+d+"-"+n),h.appendChild(r),(a=document.createElement("div")).setAttribute("class","date"),(7===s||1===d&&1===u||3===d&&15===u||4===d&&10===u||5===d&&13===u||6===d&&1===u||7===d&&1===u||8===d&&20===u||10===d&&23===u||11===d&&1===u||12===d&&25===u||12===d&&26===u)&&a.classList.add("holiday"),u===today.getDate()&&e===today.getFullYear()&&t===today.getMonth()&&a.classList.add("today"),a.innerHTML=u,r.appendChild(a),createEvent(r,e+"."+d+"."+n),u++;s.appendChild(h)}document.querySelectorAll("td").forEach(e=>{e.addEventListener("mousedown",e=>{e.preventDefault();const t="TD"===e.target.tagName?e.target:e.target.parentElement;document.querySelectorAll(".selected").forEach(e=>{e.classList.remove("selected")}),end.value="",t.classList.add("selected"),start.value=t.getAttribute("data-date")}),e.addEventListener("mouseup",e=>{e.preventDefault();const t="TD"===e.target.tagName?e.target:e.target.parentElement;if(t.getAttribute("data-date")>start.value){end.value=t.getAttribute("data-date");const e=document.getElementsByTagName("TD");for(let a of e)a.getAttribute("data-date")>start.value&&a.getAttribute("data-date")<=t.getAttribute("data-date")&&a.classList.add("selected")}})}),addSelect(end,start)}function previous(){renderCalendar(currentYear=0===currentMonth?currentYear-1:currentYear,currentMonth=0===currentMonth?11:currentMonth-1)}function showToday(){currentMonth=today.getMonth(),renderCalendar(currentYear=today.getFullYear(),currentMonth)}function next(){renderCalendar(currentYear=11===currentMonth?currentYear+1:currentYear,currentMonth=(currentMonth+1)%12)}function createEvent(e,t){events.forEach(a=>{if(a.start===t||a.start<=t&&a.end>=t){const t=document.createElement("div");t.setAttribute("class","event"),t.innerHTML=a.name,e.appendChild(t)}})}function addSelect(){if(document.querySelectorAll(".selected").forEach(e=>{e.classList.remove("selected")}),start.value&&(document.querySelector('[data-date="'+start.value+'"]')&&document.querySelector('[data-date="'+start.value+'"]').classList.add("selected"),end.value)){const e=document.getElementsByTagName("TD");for(let t of e)t.getAttribute("data-date")>=start.value&&t.getAttribute("data-date")<=end.value&&t.classList.add("selected")}}window.onload=async function(){let e=await fetch("calendar/json",{method:"GET",headers:{"Content-type":"application/json"}});if(!e.ok)return void console.log("JSON error");let t=await e.json();events=t.events,renderCalendar(currentYear,currentMonth)};